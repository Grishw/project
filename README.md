# Система прогнозирования временных рядов (Flask + TensorFlow)

Приложение для загрузки данных из CSV, предобработки, выбора модели (MLP/CNN/RNN), обучения и построения прогноза с интерактивной визуализацией (Plotly). Поддерживается сохранение состояния проекта и экспорт страницы в PDF.

## Стек
- Язык: Python 3.10
- Веб: Flask
- ML/DL: TensorFlow 2.x (MLP, CNN, RNN)
- Данные: pandas, numpy
- Визуализация: Plotly (через CDN)
- Контейнеризация: Docker, docker-compose

## Возможности
- Загрузка CSV-файла
- Просмотр инфо о данных: первые строки (head), размеры, типы столбцов, пропуски
- Выбор признаков: target и features
- Предобработка: заполнение пропусков, выбор сегмента (последние N или CUSUM), кривая «длительности изменения»
- Обучение моделей (MLP/CNN/RNN) и построение прогноза с заданным горизонтом
- Визуализация: таблицы и графики (данные, границы CUSUM, кривая, прогноз)
- Сохранение прогресса проекта (snapshot) и восстановление при открытии
- Экспорт страницы проекта в PDF (через печать браузера)

## Структура проекта
```
project/
  app.py                      # инициализация Flask и blueprints
  Dockerfile
  docker-compose.yml
  requirements.txt
  modules/
    data/
      ingest.py               # загрузка csv, предпросмотр, выборка колонок
      preprocess.py           # fillna, выбор сегмента, CUSUM, кривая
    models/
      tf_models.py            # сборка моделей MLP/CNN/RNN и инференс
    storage/
      projects.py             # хранение списка проектов и snapshot'ов
    web/
      routes.py               # главная, создание/карточка проекта
      project_page.py         # страница проекта и API (upload/select/preprocess/train)
  templates/
    index.html                # главная (карточки проектов)
    project_new.html          # создание проекта
    project_card.html         # карточка проекта
    project_view.html         # страница проекта с графиками
    404.html
  static/
    styles.css
  data/                       # создаётся автоматически; проекты и snapshots
  pict.jpg                    # макет/картинка
```

## Запуск
### В Docker
```bash
docker compose up --build
```
Откройте `http://localhost:8000`.

### Локально (без Docker)
### linux
```bash
python -m venv .venv
. .venv/bin/activate   # Windows: .venv\\Scripts\\activate
pip install -r requirements.txt
gunicorn app:app -b 0.0.0.0:8000
```
Откройте `http://localhost:8000`.
### Windows
```bash
python -m venv .venv
. .venv/bin/activate   # Windows: .venv\\Scripts\\activate
pip install -r requirements.txt
```
Запустить файл app.py
Откройте адрес из консоли.
## Как пользоваться
1. На главной странице создайте новый проект.
2. На странице проекта загрузите CSV (перетащите файл или выберите через диалог).
3. Из списка колонок выберите `target` и при необходимости `features` — таблица и график обновятся.
4. Выполните предобработку: выберите метод (CUSUM или «последние 200») и нажмите «Выполнить» — появятся графики сегмента и кривой.
5. В блоке «Модель и прогноз» выберите тип модели, окно, горизонт и число эпох, затем нажмите «Обучить и спрогнозировать» — отобразится Loss и график прогноза.
6. Для экспорта страницы в PDF используйте кнопку «Экспортировать страницу в PDF» (откроется окно печати браузера).

## API (кратко)
- POST `/project/<id>/upload` — загрузка CSV (multipart/form-data: file)
- POST `/project/<id>/select` — выбор target/features, возвращает сэмпл данных
- POST `/project/<id>/preprocess` — предобработка (`{"target":"col","method":"cusum|last"}`)
- POST `/project/<id>/train` — обучение и прогноз (`{"target":"col","model":"mlp|cnn|rnn","window":32,"horizon":12,"epochs":5}`)

Состояние проекта сохраняется в `data/projects/<id>/snapshot.json` и подхватывается при открытии страницы.

## Модели
- MLP: полносвязная сеть по окну значений
- CNN: 1D Conv с causal-паддингом и GAP
- RNN: SimpleRNN + Dense

Данные подаются как скользящее окно длиной `window`, прогнозируется вектор длиной `horizon`.

## Этапы работы (соответствие требованиям)
1) Загрузка данных — upload
2) Просмотр информации — preview (head, info)
3) Предподготовка — выбор target/features
4) Инфо о отобранных данных — таблица/график
5) Выбор модели — селектор MLP/CNN/RNN
6) Поиск границ — CUSUM/последние 200
7) Отображение границ — вертикальные линии на графике
8) Отбор данных — сегмент для дальнейшей работы
9) График отобранных данных — pp_plot
10) График «время–порог» — кривая длительности изменения
11) Обучение — /train
12) Прогноз — визуализация на графике
13) Экспорт — кнопка печати в PDF

## Замечания
- Для больших CSV стоит добавить постраничную загрузку/читатель по частям.
- Гиперпараметры и модели можно расширить (LSTM/GRU, регуляризация, нормализация).
- Для продакшена желательно вынести статику, добавить авторизацию и БД.

Лицензия: MIT.
