<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ project.name }}</title>
    <link rel="stylesheet" href="/static/styles.css" />
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script defer src="/static/js/project_view.js"></script>
  </head>
  <body>
    <div id="app-root" data-project-id="{{ project.id }}"></div>
    <script id="snapshot-data" type="application/json">{{ snapshot|tojson|safe }}</script>
    <div class="container">
      <aside class="sidebar">
        <div class="card">
          <h3>Данные</h3>
          <form id="upload-form" action="/project/{{ project.id }}/upload" method="post" enctype="multipart/form-data">
            <div id="dropzone" class="card-thumb">
              <div class="placeholder">Перетащите CSV сюда</div>
            </div>
            <input id="file" type="file" name="file" accept=".csv" />
            <button id="upload-btn" class="btn primary" type="submit">Загрузить</button>
          </form>
        </div>
        <div class="card">
          <h3>Этапы</h3>
          <ol class="steps">
            <li class="step step-done">Загрузка данных</li>
            <li class="step">Информация о данных</li>
            <li class="step">Предподготовка</li>
            <li class="step">Выбор модели</li>
            <li class="step">Обучение и прогноз</li>
            <li class="step">Экспорт PDF</li>
          </ol>
        </div>
      </aside>
      <main>
        <div id="work" class="card">
          <h2>{{ project.name }}</h2>
          <div id="preview-table" class="table"></div>
          <div id="selectors"></div>
        </div>
        <div class="card">
          <h3>Отображение отобранных данных</h3>
          <div id="seleted-table" class="table"></div>
          <div><strong>График: динамика изменения отобранных параметров</strong></div>
          <div id="plot"></div>
        </div>
        <div class="card">
          <h3>Выделение фрагмента данных</h3>
          <div class="form-group form-grid">
            <label>Метод
              <select id="pp_method">
                <option value="cusum">CUSUM</option>
                <option value="last">Последние 200</option>
              </select>
            </label>
            <button id="pp_run" class="btn primary" type="button">Выполнить</button>
          </div>
          <div><strong>График: выделенный фрагмент</strong></div>
          <div id="pp_plot"></div>
          <div><strong>График: время достижения порога изменения значения</strong></div>
          <div id="pp_curve"></div>
        </div>
        <div class="card">
          <h3>Обучение модели</h3>
          <div class="form-grid">
            <label>Модель
              <select id="mdl">
                <option value="mlp">Многослойный персептрон</option>
                <option value="cnn">Сверточная сеть</option>
                <option value="rnn">Рекуррентная сеть</option>
              </select>
            </label>
            <label>Окно<input id="win" type="number" value="32" min="4" /></label>
            <label>Горизонт
              <select id="hor">
                <option>1</option><option>4</option><option selected>7</option><option>12</option><option>24</option><option>48</option><option>128</option>
              </select>
            </label>
            <label>Эпохи<input id="ep" type="number" value="5" min="1" /></label>
            <label>Batch<input id="bs" type="number" value="32" min="1" /></label>
            <label>Learning rate<input id="lr" type="number" step="0.0001" value="0.001" min="0.000001" /></label>
            <label>Валидация %<input id="val" type="number" step="0.05" value="0.2" min="0" max="0.5" /></label>
            <button id="train_run" class="btn primary" type="button" style="grid-column: 1 / -1">Обучить</button>
          </div>
          <div id="train_info" class="muted"></div>
          <div style="margin-top:8px"><strong>График: динамика ошибки по эпохам</strong></div>
          <div id="train_curve"></div>
        </div>
        <div class="card">
          <h3>Лог обучения</h3>
          <pre id="train_log" style="white-space: pre-wrap; margin: 0;"></pre>
        </div>
        <div class="card">
          <h3>Прогноз</h3>
          <div class="form-group">
            <label>Шаги прогноза<input id="fc_steps" type="number" value="12" min="1" /></label>
            <label>Контекст (точек для 1-го предсказания)<input id="fc_ctx" type="number" value="64" min="1" /></label>
            <button id="forecast_run" class="btn primary" type="button">Спрогнозировать</button>
          </div>
          <div><strong>График: прогноз</strong></div>
          <div id="forecast_plot"></div>
        </div>
        
        <div class="card">
          <h3>Экспорт</h3>
          <button id="export_pdf" class="btn primary" type="button">Экспортировать страницу в PDF</button>
        </div>
      </main>
    </div>
  </body>
</html>